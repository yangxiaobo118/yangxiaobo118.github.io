<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>nginx+tomcat+memcached集群 | vigorous</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="vigorous">
    <meta name="author" content="vigorous">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="vigorous" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/programming/" class="animsition-link">programming<small>(1)</small></a></li>
				    
				    <li><a href="/categories/data/" class="animsition-link">数据存储<small>(2)</small></a></li>
				    
				    <li><a href="/categories/programming/" class="animsition-link">编程<small>(4)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">vigorous</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2018-01-20T01:09:27.000Z" itemprop="datePublished">
          2018-01-20
      </time>
    
    
    | 
    <a href='/tags/nginx-memcached/'>nginx,memcached</a>
    
    
</span>
                <h1>nginx+tomcat+memcached集群</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h2 id="Nginx-Tomcat-MemCached集群配置"><a href="#Nginx-Tomcat-MemCached集群配置" class="headerlink" title="Nginx+Tomcat+MemCached集群配置"></a>Nginx+Tomcat+MemCached集群配置</h2><p>一、Nginx 介绍<br>Nginx (发音同 engine x)是一款高性能的 HTTP 和 反向代理 服务器国内使用nginx Web服务器的网站有：新浪、网易、 腾讯等。</p>
<p>二、Tomcat 介绍<br>Tomcat是Apache 软件基金会（Apache Software Foundation）的Jakarta 项目中的一个核心项目，由Apache、Sun 和其他一些公司及个人共同开发而成。由于有了Sun 的参与和支持，最新的Servlet 和JSP 规范总是能在Tomcat 中得到体现，Tomcat 5支持最新的Servlet 2.4 和JSP 2.0 规范。因为Tomcat 技术先进、性能稳定，而且免费，因而深受Java 爱好者的喜爱并得到了部分软件开发商的认可，成为目前比较流行的Web 应用服务器。目前最新版本是8.0。</p>
<p>三、MemCached 介绍<br>Memcached 是一个高性能的分布式内存对象缓存系统，用于动态Web应用以减轻数据库负载。它通过在内存中缓存数据和对象来减少读取数据库的次数，从而提高动态、数据库驱动网站的速度。Memcached基于一个存储键/值对的hashmap。其守护进程(daemon )是用C写的，但是客户端可以用任何语言来编写，并通过memcached协议与守护进程通信。</p>
<p>四、实验环境：物理机：192.168.126.1  win7</p>
<pre><code>      虚拟机: 192.168.126.15 CentOS-5.5  

      在物理主机上安装Nginx服务,memcached服务,配置Tomcat－台端口8080

      在虚拟机上配置一台Tomcat 端口8080

      熟悉Linux的朋友也可在Linux上搭建Nginx + memcached 服务


download Tomcat: http://mirror.esocc.com/apache/tomcat/tomcat-7/v7.0.54/bin/apache-tomcat-7.0.54-windows-x86.zip
</code></pre><p>五、准备一个java web小项目测试本人此处项目名为Session</p>
<pre><code> 将些项目发布到物理机Tomcat 192.168.126.1:8080 和虚拟机Tomcat 192.168.126.15:8080 注意端口不能是80，80端口由nginx服务器代理。


 项目结构：一个实体User类，一个LoginServlet类处理登录请求，一个login.jsp登录页面，一个success.jsp登录成功页面
package com.rx.vo;

import java.io.Serializable;

public class User implements Serializable{        

    private static final long serialVersionUID = 7073950136835429991L;

    private String userId;

    private String username;

    private String password;

    public String getUserId() {
        return userId;
    }

    public void setUserId(String userId) {
        this.userId = userId;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public User() {
        super();
        // TODO Auto-generated constructor stub
    }

    public User(String userId, String username, String password) {
        super();
        this.userId = userId;
        this.username = username;
        this.password = password;
    }


}

package com.rx.servlet;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.rx.vo.User;

@WebServlet(name = &quot;LoginServlet&quot; , urlPatterns = &quot;/loginServlet.do&quot;)
public class LoginServlet extends HttpServlet{

    /**
     * 
     */
    private static final long serialVersionUID = -6451894481175083005L;

    private static Map&lt;String,User&gt; users = new HashMap&lt;String,User&gt;();

    private static Log LOG = LogFactory.getLog(LoginServlet.class);

    static {
        users.put(&quot;tom&quot;, new User(&quot;1001&quot;, &quot;tom&quot;, &quot;123456&quot;));
        users.put(&quot;king&quot;, new User(&quot;1002&quot;, &quot;king&quot;, &quot;123456&quot;));
        users.put(&quot;sam&quot;, new User(&quot;1003&quot;, &quot;sam&quot;, &quot;123456&quot;));
        users.put(&quot;jack&quot;, new User(&quot;1004&quot;, &quot;jack&quot;, &quot;123456&quot;));
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

         String userName = request.getParameter(&quot;userName&quot;);  
         String password = request.getParameter(&quot;password&quot;);  
         LOG.info(&quot;Raw input:userName=&quot; + userName + &quot;,password=&quot; + password);  
         String url = request.getContextPath();
         LOG.info(&quot;URL------&gt;&gt;&quot; + url);
         if(userName!=null &amp;&amp; password!=null  
                   &amp;&amp; users.containsKey(userName)  
                   &amp;&amp; users.get(userName).getPassword().equals(password)) {  
              LOG.info(&quot;Login;status=SUCCESS&quot;);  
              HttpSession session = request.getSession();
              session.setAttribute(&quot;SESSION_USER&quot;, users.get(userName));
              LOG.info(&quot;SessionID-----&gt;&gt;&quot; + session.getId());
              response.sendRedirect(url + &quot;/success.jsp&quot;);
         } else {  
              LOG.info(&quot;Login;status=FAIL&quot;);  
              request.getRequestDispatcher(&quot;login.jsp&quot;).forward(request, response);  
         }  
    }
}
login.jsp页面内容如下：
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;  
     pageEncoding=&quot;UTF-8&quot;%&gt;  
&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;  
&lt;html&gt;  
&lt;head&gt;  
&lt;title&gt;登录页面&lt;/title&gt;  
&lt;meta http-equiv=&quot;pragma&quot; content=&quot;no-cache&quot;&gt;  
&lt;meta http-equiv=&quot;cache-control&quot; content=&quot;no-cache&quot;&gt;  
&lt;meta http-equiv=&quot;expires&quot; content=&quot;0&quot;&gt;  
&lt;meta http-equiv=&quot;keywords&quot; content=&quot;keyword1,keyword2,keyword3&quot;&gt;  
&lt;meta http-equiv=&quot;description&quot; content=&quot;This is my page&quot;&gt;  
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/main.css&quot;&gt;&lt;/link&gt;
&lt;/head&gt;  
&lt;%
    String ip = request.getLocalAddr();
    String id = session.getId();
%&gt;
&lt;body&gt;  

 &lt;form method=&quot;post&quot; action=&quot;loginServlet.do&quot;&gt;
        &lt;table class=&quot;table&quot;&gt;   
            &lt;tr&gt;
                &lt;td colspan=&quot;2&quot;&gt;                    
                    &lt;b&gt;SESSION_ID = &lt;%=id %&gt;&lt;/b&gt;                
                &lt;/td&gt;
            &lt;/tr&gt;       
            &lt;tr&gt;        
                &lt;td height=&quot;15&quot; colspan=&quot;2&quot;&gt;
                    &lt;b&gt;&lt;%=ip %&gt; 用户登录&lt;/b&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td width=&quot;80&quot;&gt;&lt;b&gt;用户名&lt;/b&gt;&lt;/td&gt;
                &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;userName&quot; value=&quot;&quot; /&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;&lt;b&gt;密 码&lt;/b&gt;&lt;/td&gt;
                &lt;td&gt;&lt;input type=&quot;password&quot; name=&quot;password&quot; value=&quot;&quot; /&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td colspan=&quot;2&quot;&gt;
                    &lt;input type=&quot;submit&quot; value=&quot;登 录&quot; /&gt;
                    &lt;input type=&quot;reset&quot; value=&quot;重 置&quot; /&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/form&gt;  
&lt;/body&gt;  
&lt;/html&gt;  


success.jsp内容如下：
&lt;%@ page language=&quot;java&quot; import=&quot;com.rx.vo.*&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;    
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;登录成功页面&lt;/title&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/main.css&quot;&gt;&lt;/link&gt;
&lt;/head&gt;

&lt;%  
    User user = (User) session.getAttribute(&quot;SESSION_USER&quot;);  
    String ip = request.getLocalAddr();
    String id = session.getId();
    String username = &quot;&quot;;
    if (user != null) {
        username = user.getUserId() + &quot;-------&gt;&gt;&quot; + user.getUsername() + &quot;-----&gt;&gt;&quot; + user.getPassword();
    }
%&gt;  
&lt;body&gt;    
     &lt;h2 class=&quot;title&quot;&gt;&lt;%=ip %&gt; 服务器处理结果 SESSIONID = &lt;%=id %&gt; &lt;/h2&gt; 
     &lt;h2 class=&quot;title&quot;&gt;当前登录用户：&lt;%=username %&gt; &lt;a href=&quot;index.html&quot;&gt;主页&lt;/a&gt;&lt;/h2&gt;      
&lt;/body&gt;  
&lt;/html&gt;           
</code></pre><p>六、download Nginx: <a href="http://nginx.org/download/nginx-1.6.0.zip" target="_blank" rel="noopener">http://nginx.org/download/nginx-1.6.0.zip</a> 目前最新版本是nginx-1.7.1<br>并解压到E:\nginx-1.6.0目录中,在命令提示窗口中进入到E:\nginx-1.6.0目录<br>nginx.exe        #启动nginx服务<br>nginx -s stop    #停止nginx服务<br>nginx -s reload  #重新启动nginx<br>nginx -s quit    #退出nginx<br>nginx -t         #检测配置文件的正确性<br>启动Nginx后输入<a href="http://127.0.0.1/" target="_blank" rel="noopener">http://127.0.0.1/</a> 可以看到nginx的欢迎页面了，非常友好</p>
<p>接下来配置配置Nginx负载均衡，我的目录在E:\nginx-1.6.0\conf\nginx.conf以下是我简单配置</p>
<p>#是注释内容，配置文件修改完成后启动两台Tomcat服务，然后重新启动Nginx服务。<br>输入：<a href="http://127.0.0.1/Session/login.jsp" target="_blank" rel="noopener">http://127.0.0.1/Session/login.jsp</a><br>响应结果：<br>192.168.126.1 用户登录<br>再次刷新：<br>192.168.126.15 用户登录<br>证明Nginx反向代理和负载均衡配置成功了。</p>
<p>#user  nobody;       #用户<br>worker_processes  1; #工作进程，根据硬件调整，大于等于CPU核数</p>
<p>#error_log  logs/error.log;  #错误日志配置</p>
<p>#error_log  logs/error.log  notice;</p>
<p>#error_log  logs/error.log  info;</p>
<p>#pid        logs/nginx.pid; #pid放置位置</p>
<p>events {</p>
<pre><code>#use epoll;  

#使用epoll的I/O 模型

# 补充说明:

#与apache相类，nginx针对不同的操作系统，有不同的事件模型

#A）标准事件模型

#Select、poll属于标准事件模型，如果当前系统不存在更有效的方法，nginx会选择select或poll

#B）高效事件模型

#Kqueue：使用于FreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 和 MacOS X.使用双处理器的MacOS #X系统使用kqueue可能会造成内核崩溃。

#Epoll:使用于Linux内核2.6版本及以后的系统。

#/dev/poll：使用于Solaris 7 11/99+, HP/UX 11.22+ (eventport), IRIX 6.5.15+ 和 Tru64 UNIX 5.1A+。

#Eventport：使用于Solaris 10. 为了防止出现内核崩溃的问题， 有必要安装安全补丁  

worker_connections  1024;

#工作进程的最大连接数量，根据硬件调整，和前面工作进程配合起来用，尽量大，但是别把cpu跑到100%就行

#每个进程允许的最多连接数， 理论上每台nginx服务器的最大连接数为worker_processes*worker_connections

keepalive_timeout 60; 
</code></pre><p>}</p>
<p>#设定http服务器，利用它的反向代理功能提供负载均衡支持<br>http {<br>    include       mime.types;<br>    default_type  application/octet-stream;  </p>
<pre><code>sendfile        on;
#tcp_nopush     on;

#keepalive_timeout  0;
keepalive_timeout  65;

#gzip  on;

#配置两台Tomcat真实服务器
upstream  B2C_WEB {      
  #ip_hash;     #目的保证客户端的ip地址不变，请求就只送到固定的一个Tomcat处理

  server 192.168.126.1:8080 weight=1 max_fails=3 fail_timeout=30s;       
  server 192.168.126.15:8080 weight=1 max_fails=3 fail_timeout=30s;

  #weight=1表示
  #这表示，如果服务器192.168.126.1 | 15在30秒内出现了3次错误，
  #那么就认为这个服务器工作不正常，从而在接下来的30秒内nginx不再去访问这个服务器。
}  

server {
    listen       80; #监听端口
    server_name  localhost;
    charset UTF-8;          
    index index.html index.htm index.jsp index.do;
    root E:\\JavaEE\\Apache-Tomcat-7.0.41\\wtpwebapps; #WEB服务的主目录

    location ~ ^/(WEB-INF)/ { 
      deny all; #禁止访问WEB-INF目录
    }            

    # 动态数据由代理服务器Tomcat处理
    location ~ .*\.(jsp|jspx|do)?$ { 
      proxy_pass http://B2C;# 反向代理         
      proxy_set_header  X-Real-IP $remote_addr;
      proxy_next_upstream http_502 http_504 error timeout invalid_header;
   }     

   # 静态数据直接读取不经过Tomcat服务器
   location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
   {        
     expires      30d; #在客户端保存时间
   }
   location ~ .*\.(js|css)?$
   {        
     expires      1h;
   }

   # 监控Nginx服务状态
   location /Nginxstatus {
     stub_status on;
     access_log   off;
   }        

    #charset koi8-r;

    #access_log  logs/host.access.log  main;

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }

}
</code></pre><p>}<br>七、download Memcached: 官方并未提供memcached windows版本 自己到网上找memcached-1.2.6-win32-bin.zip或<br>    memcached-win32-1.4.4-14.zip下载</p>
<p>八、memcached安装步骤:<br>①.解压到指定目录，如E:\memcached\<br>②.打开 开始 —&gt;&gt; 运行 —&gt;&gt; cmd 调出命令窗口，进入到memcached的解压目录<br>③.安装memcached：    输入E:\memcached\memcached.exe -d install 执行安装<br>   注意事项根据下载版本不同安装文件可能是单文件，不用质疑。<br>④.启动memcached服务：输入E:\memcached\memcached.exe -d start 启动服务</p>
<p>设置memcached，启动该服务后，memcached服务默认占用的端口是11211，占用的最大内存默认是64M。</p>
<p>如果需要修改这两个参数，比如修改端口为10000，内存为512，则输入： </p>
<p>E:\memcached\memcached.exe -p 10000 -m 512 -d start  ,  -p 表示要修改的端口，-m表示占用的最大内存(单位为M)。</p>
<p>⑤.参数介绍在安装和启动时可设置如下参数：</p>
<p>-p 监听的端口<br>-l 连接的IP地址, 默认是本机<br>-d start 启动memcached服务<br>-d restart 重起memcached服务<br>-d stop|shutdown 关闭正在运行的memcached服务<br>-d install 安装memcached服务<br>-d uninstall 卸载memcached服务<br>-u 以的身份运行 (仅在以root运行的时候有效)<br>-m 最大内存使用，单位MB。默认64MB<br>-M 内存耗尽时返回错误，而不是删除项<br>-c 最大同时连接数，默认是1024<br>-f 块大小增长因子，默认是1.25<br>-n 最小分配空间，key+value+flags默认是48<br>-h 显示帮助</p>
<p>连接memcached服务器：telnet 192.168.1.120 11211<br>输入stats查看基本信息：<br>STAT pid 1712<br>STAT uptime 5247<br>STAT time 1402624936<br>STAT version 1.2.6<br>STAT pointer_size 32<br>STAT curr_items 0<br>STAT total_items 0<br>STAT bytes 0<br>STAT curr_connections 3<br>STAT total_connections 5<br>STAT connection_structures 4<br>STAT cmd_get 0<br>STAT cmd_set 0<br>STAT get_hits 0<br>STAT get_misses 0<br>STAT evictions 0<br>STAT bytes_read 221<br>STAT bytes_written 512<br>STAT limit_maxbytes 67108864<br>STAT threads 1<br>⑤.停止memcached服务: 输入E:\memcached\memcached.exe -d stop|shutdown 进行关闭。</p>
<p>九、配置Session共享<br>①.这里需要使用一个开源项目，即Memcached Session Manager（MSM），如下链接是该开源项目的官网：<br><a href="http://code.google.com/p/memcached-session-manager/" target="_blank" rel="noopener">http://code.google.com/p/memcached-session-manager/</a><br>官方给出4种序列化方案，其中kryo是效率最高的，我下载的是javolution序列化方案jar包<br>javolution-5.4.3.1.jar<br>memcached-session-manager-1.6.1.jar<br>memcached-session-manager-tc7-1.6.1.jar #Tomcat6 则用memcached-session-manager-tc6-1.5.1.jar<br>msm-javolution-serializer-1.6.1.jar<br>msm-javolution-serializer-cglib-1.3.0.jar<br>msm-javolution-serializer-jodatime-1.3.0.jar<br>spymemcached-2.7.3.jar</p>
<p>②.将上面所述的MSG的jar包拷贝至Tomcat安装目录lib文件夹中<br>   编辑Tomcat E:\JavaEE\Apache-Tomcat-7.0.41\conf\context.xml配置文件<br>   在<context>…</context>标签之间加入如下代码：</p>
<manager classname="de.javakaffee.web.msm.MemcachedBackupSessionManager" memcachednodes="n1:localhost:11211" requesturiignorepattern=".*/.(png|gif|jpg|css|js)$" sessionbackupasync="false" sessionbackuptimeout="100" transcoderfactoryclass="de.javakaffee.web.msm.serializer.javolution.JavolutionTranscoderFactory" copycollectionsforserialization="false"><br></manager>

<p>注意此处：memcachedNodes=”n1:localhost:11211” #将localhost换成实际启动了memcached服务的主机IP</p>
<p>③.测试项目：<a href="http://127.0.0.1/Session/login.jsp" target="_blank" rel="noopener">http://127.0.0.1/Session/login.jsp</a> 登录成功页面返回结果如下：</p>
<p>192.168.126.1 服务器处理结果 SESSIONID = 2C33E37DD3EC70F1D1D66BA31D45970A-n1<br>当前登录用户：1001——-&gt;&gt;tom—–&gt;&gt;123456 </p>
<p>刷新页面返回结果如下：<br>192.168.126.15 服务器处理结果 SESSIONID = 2C33E37DD3EC70F1D1D66BA31D45970A-n1<br>当前登录用户：1001——-&gt;&gt;tom—–&gt;&gt;123456 </p>
<p>处理请求的服务器IP变化了，SESSION_ID保持一致，并且SESSION中保存的用户信息未失效说明SESSION共享成功。</p>
<p>到此利用Nginx + Tomcat + Memcached 搭建WEB服务器负载均衡SESSION失效转移成功。</p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    
    <a class="pull-right" href="/2018/01/19/redis配置介绍/">
        redis配置介绍 →
    </a>
    
</nav>

        <div class="duoshuo">


</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By vigorous. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      (function(){
        console.log('font');
        var getCss = function(path) {
          var head = document.getElementsByTagName('head')[0];
          link = document.createElement('link');
          link.href = path;
          link.rel = 'stylesheet';
          link.type = 'text/css';
          head.appendChild(link);
        };
        getCss('https://fonts.googleapis.com/css?family=Montserrat:400,700');
        getCss('https://fonts.googleapis.com/css?family=Open+Sans:400,600');
      })();
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
